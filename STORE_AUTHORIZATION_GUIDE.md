# 店铺授权功能使用指南

## 功能概述

新增的"授权新店铺"功能为商家提供了一种更快速、更安全的方式来连接 Shopify 店铺。相比传统的"添加店铺"方式，授权功能直接使用 Shopify 官方的 OAuth 2.0 授权流程，确保安全性和便捷性。

## 功能特点

### 🔐 安全性
- 使用 Shopify 官方 OAuth 2.0 授权标准
- 数据传输全程 HTTPS 加密
- 最小权限原则，仅申请必要权限
- 用户可随时撤销授权

### 🚀 便捷性
- 一键启动授权流程
- 自动跳转 Shopify 官方授权页面
- 授权完成后自动返回系统
- 实时显示授权进度

### 📊 可视化
- 授权流程步骤清晰展示
- 实时进度反馈
- 成功/失败状态明确提示
- 详细的错误信息和解决方案

## 使用步骤

### 第一步：进入店铺列表
1. 登录商家端系统
2. 导航到"我的店铺"页面
3. 在页面右上角可以看到两个按钮：
   - 🔑 **授权新店铺**（推荐）
   - ➕ **添加店铺**（传统方式）

### 第二步：选择授权方式
点击"授权新店铺"按钮，系统将跳转到授权页面，该页面包含：
- 📋 授权流程说明（4个步骤）
- 📝 店铺信息表单
- 🔒 权限说明
- 🛡️ 安全保障说明
- ❓ 常见问题解答

### 第三步：填写店铺信息
在授权表单中填写以下信息：
- **店铺域名**（必填）：输入您的 Shopify 店铺域名，例如 `your-store-name`
- **店铺名称**（可选）：为店铺设置一个易记的显示名称

> **提示**：域名不需要包含 `.myshopify.com` 后缀，系统会自动添加。

### 第四步：开始授权
1. 确认信息无误后，点击"开始授权"按钮
2. 系统会显示提示信息，告知即将跳转到 Shopify 授权页面
3. 1秒后自动跳转到 Shopify 官方授权页面

### 第五步：在 Shopify 页面确认授权
1. 在 Shopify 授权页面，您会看到：
   - 应用名称和开发者信息
   - 请求的权限列表
   - 授权确认按钮
2. 仔细查看权限列表，确认无误后点击"安装应用"或"授权"
3. 如果不同意授权，可以点击"取消"返回

### 第六步：授权处理
授权确认后，系统会自动：
1. ✅ 验证授权信息
2. 🔑 获取访问令牌
3. 📊 同步店铺信息
4. ✨ 完成连接

整个过程大约需要 3-5 秒，您可以看到实时的进度显示。

### 第七步：授权完成
授权成功后，您会看到：
- ✅ 成功提示页面
- 📋 店铺基本信息确认
- 🎯 两个操作选项：
  - "查看我的店铺"：返回店铺列表
  - "进入店铺详情"：直接查看新连接的店铺详情

## 权限说明

系统会申请以下 Shopify 权限：

| 权限 | 用途 | 必要性 |
|------|------|--------|
| `read_products` | 读取商品信息 | ✅ 必需 - 用于商品同步和管理 |
| `write_products` | 管理商品 | ✅ 必需 - 用于商品铺货和更新 |
| `read_orders` | 读取订单信息 | ✅ 必需 - 用于订单同步和管理 |
| `read_customers` | 读取客户信息 | ✅ 必需 - 用于客户数据分析 |
| `read_inventory` | 读取库存信息 | ✅ 必需 - 用于库存同步 |
| `write_inventory` | 管理库存 | ✅ 必需 - 用于库存更新 |

## 常见问题

### Q1：授权和添加店铺有什么区别？
**A1**：
- **授权新店铺**：使用 Shopify 官方 OAuth 流程，更安全快捷，推荐使用
- **添加店铺**：需要手动输入更多信息，适合需要特殊配置的情况

### Q2：授权失败怎么办？
**A2**：常见原因和解决方案：
- 店铺域名错误 → 检查域名拼写是否正确
- 店铺不存在或未激活 → 确认店铺状态正常
- 网络连接问题 → 检查网络连接后重试
- 授权被拒绝 → 重新授权并确认权限

### Q3：如何撤销授权？
**A3**：
1. 登录您的 Shopify 管理后台
2. 进入"设置" → "应用和销售渠道"
3. 找到我们的应用，点击"卸载"
4. 确认卸载即可撤销授权

### Q4：授权后数据安全吗？
**A4**：
- ✅ 使用 Shopify 官方授权标准
- ✅ 数据传输全程加密
- ✅ 仅获取必要权限
- ✅ 严格遵守数据保护法规
- ✅ 可随时撤销授权

### Q5：可以同时授权多个店铺吗？
**A5**：
是的，您可以授权多个 Shopify 店铺。每个店铺的授权都是独立的，互不影响。

## 技术说明

### OAuth 2.0 流程
1. **授权请求**：用户点击授权后，系统构建授权 URL 并跳转到 Shopify
2. **用户授权**：用户在 Shopify 页面确认授权
3. **授权码返回**：Shopify 将授权码通过回调 URL 返回给系统
4. **令牌交换**：系统使用授权码向 Shopify 请求访问令牌
5. **信息获取**：使用访问令牌获取店铺信息
6. **数据保存**：将店铺信息和令牌保存到数据库

### 安全措施
- **State 参数**：防止 CSRF 攻击
- **HTTPS 传输**：确保数据传输安全
- **令牌加密存储**：访问令牌加密保存
- **权限最小化**：仅申请必要权限
- **定期审计**：定期检查权限使用情况

## 故障排除

### 授权页面无法打开
- 检查网络连接
- 确认店铺域名正确
- 尝试清除浏览器缓存

### 授权后跳转失败
- 检查回调 URL 配置
- 确认应用设置正确
- 联系技术支持

### 店铺信息同步失败
- 检查网络连接
- 确认店铺权限正常
- 重新进行授权

## 联系支持

如果您在使用授权功能时遇到问题，请通过以下方式联系我们：

- 📧 邮箱：support@example.com
- 💬 在线客服：系统内"客服支持"页面
- 📞 电话：400-xxx-xxxx（工作日 9:00-18:00）

---

*最后更新：2024年12月* 