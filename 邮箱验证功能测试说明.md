# 商家端修改密码邮箱验证功能

## 功能概述

为商家端个人设置页面的修改密码功能添加了邮箱验证步骤，提高账户安全性。

## 实现的功能

### 1. 邮箱验证流程
- **步骤1**: 输入当前密码
- **步骤2**: 点击"获取验证码"按钮，向用户邮箱发送6位数字验证码
- **步骤3**: 输入收到的验证码
- **步骤4**: 输入新密码和确认密码
- **步骤5**: 提交修改

### 2. 安全特性
- **当前密码验证**: 发送验证码前需要先输入当前密码
- **邮箱验证码**: 6位数字验证码，发送到用户绑定邮箱
- **倒计时防护**: 60秒倒计时，防止频繁发送验证码
- **表单验证**: 完整的前端表单验证规则

### 3. 用户体验优化
- **清晰提示**: 显示验证码将发送到的邮箱地址
- **加载状态**: 发送验证码和提交修改时的加载状态
- **错误处理**: 针对不同错误类型的具体提示信息
- **倒计时显示**: 实时显示重新发送验证码的倒计时

## 技术实现

### 修改的文件
- `src/views/merchant/Profile.vue` - 主要实现文件

### 新增的功能组件
1. **邮箱验证码输入框**
   - 验证码输入框和发送按钮的组合
   - 倒计时状态显示
   - 邮箱地址提示

2. **验证码发送逻辑**
   - 前置验证当前密码
   - 60秒倒计时机制
   - 错误处理和用户提示

3. **表单验证规则**
   - 验证码必填验证
   - 6位数字格式验证
   - 正则表达式验证

4. **提交流程优化**
   - 包含验证码的密码修改API调用
   - 详细的错误分类处理
   - 成功后的重新登录流程

## 测试步骤

### 访问页面
1. 启动开发服务器: `npm run serve`
2. 访问: `http://localhost:8081/merchant/profile`
3. 点击"修改密码"按钮

### 测试验证码发送
1. 不输入当前密码，直接点击"获取验证码" - 应显示警告提示
2. 输入当前密码，点击"获取验证码" - 应显示成功提示和倒计时
3. 倒计时期间按钮应为禁用状态

### 测试表单验证
1. 不输入验证码提交 - 应显示验证码必填错误
2. 输入非6位数字 - 应显示格式错误
3. 输入正确格式验证码 - 验证通过

### 测试密码修改
1. 填写完整表单信息
2. 点击"确认修改" - 应显示成功提示
3. 成功后应弹出重新登录确认框

## API接口说明

### 发送验证码接口 (模拟)
```javascript
// 发送密码修改验证码
await sendPasswordChangeVerifyCodeAPI(userInfo.email, passwordFormData.currentPassword)
```

### 修改密码接口 (模拟)
```javascript
// 验证码验证并修改密码
await changePasswordWithVerifyCodeAPI({
  currentPassword: passwordFormData.currentPassword,
  verifyCode: passwordFormData.verifyCode,
  newPassword: passwordFormData.newPassword,
  email: userInfo.email
})
```

## 样式特性

- 验证码输入框和按钮的响应式布局
- 倒计时状态的视觉反馈
- 邮箱提示信息的样式
- 与现有设计风格保持一致

## 注意事项

1. **API集成**: 当前使用模拟API，实际部署时需要替换为真实的后端接口
2. **验证码有效期**: 建议后端设置验证码5-10分钟有效期
3. **安全考虑**: 后端应验证当前密码正确性后才发送验证码
4. **邮件模板**: 需要配置邮箱验证码的邮件模板
5. **错误处理**: 根据实际API返回的错误码进行错误处理优化

## 兼容性

- 兼容现有的密码强度检查功能
- 保持原有的密码验证规则
- 不影响其他个人设置功能
- 响应式设计，支持移动端访问
